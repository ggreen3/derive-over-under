<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Digits Over/Under Trading Bot</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #121212;
      color: #f4f4f4;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
      background: #1e1e1e;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    h2 {
      color: #00bcd4;
      text-align: center;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    .stats div {
      background: #2a2a2a;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    .stats div span {
      font-size: 24px;
      font-weight: bold;
      display: block;
      margin-top: 5px;
    }
    #wins { color: #4caf50; }
    #losses { color: #f44336; }
    #winRate { color: #00bcd4; }
    #balance { color: #ffc107; }
    .log {
      background: #333;
      padding: 15px;
      border-radius: 5px;
      height: 400px;
      overflow-y: auto;
      font-family: monospace;
      margin-top: 20px;
    }
    .log p {
      margin: 5px 0;
      padding: 5px;
      border-bottom: 1px solid #444;
    }
    .log .win { color: #4caf50; }
    .log .loss { color: #f44336; }
    .log .info { color: #00bcd4; }
    button {
      background: #00bcd4;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px;
    }
    button:hover { opacity: 0.9; }
    #stopBtn { background: #f44336; }
    input {
      width: calc(100% - 20px);
      padding: 10px;
      margin: 10px;
      background: #2a2a2a;
      color: #fff;
      border: 1px solid #444;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Digits Over/Under Trading Bot</h2>
    <div class="stats">
      <div>Wins: <span id="wins">0</span></div>
      <div>Losses: <span id="losses">0</span></div>
      <div>Win Rate: <span id="winRate">0.00%</span></div>
      <div>Balance: <span id="balance">$0.00</span></div>
    </div>
    <div>
      <input id="apiKey" type="text" placeholder="Enter your API Key" />
      <button id="startBtn">Start Trading</button>
      <button id="stopBtn">Stop Trading</button>
    </div>
    <div class="log" id="log"></div>
  </div>
  <script>
    class TradingBot {
      constructor() {
        this.ws = null;
        this.apiKey = '';
        this.accountBalance = 0;
        this.winCount = 0;
        this.lossCount = 0;
        this.isRunning = false;
      }

      log(message, type = 'info') {
        const logDiv = document.getElementById("log");
        const now = new Date().toLocaleTimeString();
        const logEntry = document.createElement('p');
        logEntry.className = type;
        logEntry.textContent = `${now} - ${message}`;
        logDiv.insertBefore(logEntry, logDiv.firstChild);
        while (logDiv.children.length > 100) {
          logDiv.removeChild(logDiv.lastChild);
        }
      }

      updateStats() {
        const winRate = this.winCount + this.lossCount > 0 
          ? ((this.winCount / (this.winCount + this.lossCount)) * 100).toFixed(2) 
          : "0.00";
        document.getElementById("wins").textContent = this.winCount;
        document.getElementById("losses").textContent = this.lossCount;
        document.getElementById("winRate").textContent = `${winRate}%`;
        document.getElementById("balance").textContent = `$${this.accountBalance.toFixed(2)}`;
      }

      startBot() {
        if (this.isRunning) return;
        this.apiKey = document.getElementById("apiKey").value.trim();
        if (!this.apiKey) {
          this.log("Please enter a valid API key", "loss");
          return;
        }
        this.isRunning = true;
        this.connectWebSocket();
      }

      stopBot() {
        if (this.ws) {
          this.ws.close();
        }
        this.isRunning = false;
        this.log("Trading bot stopped");
      }

      connectWebSocket() {
        try {
          this.ws = new WebSocket("wss://ws.binaryws.com/websockets/v3?app_id=1089");
          this.ws.onopen = () => {
            this.log("Connected to Deriv API");
            this.authorize();
          };
          this.ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.error) {
              this.log(`Error: ${data.error.message}`, 'loss');
              this.stopBot();
              return;
            }
            switch (data.msg_type) {
              case "authorize":
                this.handleAuthorization(data);
                break;
              case "proposal":
                this.handleProposal(data);
                break;
              case "buy":
                this.handleBuyResponse(data);
                break;
              case "proposal_open_contract":
                this.handleContractUpdate(data);
                break;
            }
          };
          this.ws.onclose = () => {
            this.log("WebSocket connection closed");
            this.isRunning = false;
          };
          this.ws.onerror = (error) => {
            this.log(`WebSocket error: ${error.message}`, 'loss');
            this.isRunning = false;
          };
        } catch (error) {
          this.log(`Error starting bot: ${error.message}`, 'loss');
          this.isRunning = false;
        }
      }

      authorize() {
        this.ws.send(JSON.stringify({ authorize: this.apiKey }));
      }

      handleAuthorization(data) {
        if (data.error) {
          this.log(`Authorization failed: ${data.error.message}`, 'loss');
          this.stopBot();
          return;
        }
        this.accountBalance = data.authorize.balance;
        this.updateStats();
        this.log("Authorization successful");
        this.subscribeToTicks();
      }

      subscribeToTicks() {
        const markets = ["R_10", "R_25", "R_50", "R_75", "R_100"];
        markets.forEach(market => {
          this.ws.send(JSON.stringify({ ticks: market, subscribe: 1 }));
        });
      }

      requestProposal(market, signal) {
        const contractType = signal === 'OVER' ? 'DIGITOVER' : 'DIGITUNDER';
        const barrier = signal === 'OVER' ? '6' : '4';
        this.ws.send(JSON.stringify({
          proposal: 1,
          amount: 1,
          basis: "stake",
          contract_type: contractType,
          currency: "USD",
          duration: 5,
          duration_unit: "t",
          symbol: market,
          barrier: barrier
        }));
      }

      handleProposal(data) {
        if (data.proposal) {
          this.log(`Received proposal: ${data.proposal.longcode}`);
          this.buyContract(data.proposal.id, data.proposal.ask_price);
        }
      }

      buyContract(proposalId, price) {
        this.ws.send(JSON.stringify({
          buy: proposalId,
          price: price
        }));
      }

      handleBuyResponse(data) {
        if (data.buy) {
          this.log(`Trade executed: ${data.buy.longcode}`);
          this.monitorContract(data.buy.contract_id, data.buy.buy_price);
        }
      }

      monitorContract(contractId, stake) {
        setTimeout(() => {
          this.ws.send(JSON.stringify({
            proposal_open_contract: 1,
            contract_id: contractId
          }));
        }, 5000);
      }

      handleContractUpdate(data) {
        const contract = data.proposal_open_contract;
        if (contract.is_sold) {
          const isWin = contract.profit > 0;
          if (isWin) {
            this.winCount++;
            this.accountBalance += contract.buy_price * 0.95;
            this.log(`Trade WON! Profit: $${(contract.buy_price * 0.95).toFixed(2)}`, 'win');
          } else {
            this.lossCount++;
            this.accountBalance -= contract.buy_price;
            this.log(`Trade LOST. Loss: $${contract.buy_price.toFixed(2)}`, 'loss');
          }
          this.updateStats();
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const bot = new TradingBot();
      document.getElementById("startBtn").addEventListener("click", () => {
        if (!bot.isRunning) {
          bot.startBot();
        }
      });
      document.getElementById("stopBtn").addEventListener("click", () => {
        bot.stopBot();
      });
    });
  </script>
</body>
</html>
